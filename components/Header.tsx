"use client";

import { useState, useRef, useEffect } from "react";
import { PrismicNextLink } from "@prismicio/next";
import type { Locales } from "./Layout";

type Props = {
  locales: Locales[];
  currentLang: string;
};

const UKFlag = (
  <svg
    width="40"
    height="40"
    viewBox="0 0 40 40"
    fill="none"
    data-astro-cid-ukn4ixmn="true"
  >
    <path
      d="M23.2253 32.75H32.1622C33.2665 32.75 34.2048 32.4991 34.984 32.0621L23.2253 24.9982V32.75ZM37.5579 28.3681C37.6852 27.7961 37.75 27.1903 37.75 26.5619V23.7494H29.8687L37.5556 28.3681M2.19556 12.3644C2.06319 12.9629 1.99761 13.5744 2.00007 14.1875V17H9.91148L2.19556 12.3644ZM16.5226 8H7.58564C6.4892 8 5.55696 8.2475 4.78113 8.67838L16.5226 15.7321V8ZM4.81687 32.0896C5.58545 32.5081 6.50539 32.75 7.58564 32.75H16.5226V25.0573L4.81687 32.0896ZM2.00007 23.75V26.5625C2.00007 27.2099 2.06821 27.8338 2.20282 28.4204L9.97739 23.75H2.00007ZM35.0192 8.70594C34.2339 8.25706 33.2827 8 32.1622 8H23.2253V15.7912L35.0192 8.70594V8.70594ZM37.7478 17V14.1875C37.7478 13.5721 37.6846 12.9787 37.5623 12.4173L29.9347 17H37.7478Z"
      fill="#2E3192"
    ></path>
    <path
      d="M29.9346 17L37.5622 12.4173C37.2126 10.8063 36.3613 9.47263 35.0191 8.70594L23.2252 15.7912V8H22.1081V18.125H37.7477V17H29.9346ZM2 22.625V23.75H9.97732L2.20276 28.4204C2.57196 30.0264 3.4489 31.3449 4.81681 32.0896L16.5225 25.0573V32.75H17.6396V22.625H2ZM37.7477 22.625H22.1081V32.75H23.2252V24.9982L34.9839 32.0626C36.3362 31.3044 37.1981 29.978 37.5555 28.3693L29.8687 23.75H37.7477V22.625ZM16.5225 8V15.7321L4.78106 8.67838C3.42376 9.43213 2.55632 10.7563 2.19494 12.3644L9.91141 17H2V18.125H17.6396V8H16.5225Z"
      fill="#E6E7E8"
    ></path>
    <path
      d="M22.1081 18.125V8H17.6396V18.125H2V22.625H17.6396V32.75H22.1081V22.625H37.7477V18.125H22.1081Z"
      fill="#BE1E2D"
    ></path>
    <path
      d="M14.2577 16.9998L3.05859 10.2672C2.81785 10.6272 2.62459 11.0232 2.46484 11.4451L11.7073 16.9998H14.256M37.2434 29.4254L27.8524 23.7498H25.2518L36.5977 30.623C36.8609 30.2527 37.0777 29.8513 37.2434 29.4277M35.9191 9.34473L23.2119 16.9998L25.7919 17.0015L36.7569 10.3904C36.5123 9.9421 36.2542 9.65298 35.9191 9.34473ZM3.0167 30.4295C3.26796 30.8148 3.57033 31.1638 3.91542 31.4667L16.5617 23.7498H14.013L3.0167 30.4295Z"
      fill="#BE1E2D"
    ></path>
  </svg>
);

const FRFlag = (
  <svg
    width="40"
    height="40"
    viewBox="0 0 40 40"
    xmlns="http://www.w3.org/2000/svg"
  >
    <defs>
      <clipPath id="fr-rounded-flag">
        <rect x="4" y="10" width="32" height="20" rx="2" ry="2" />
      </clipPath>
    </defs>
    <g clipPath="url(#fr-rounded-flag)">
      <rect x="4" y="10" width="10.67" height="20" fill="#0055A4" />
      <rect x="14.67" y="10" width="10.66" height="20" fill="#FFFFFF" />
      <rect x="25.33" y="10" width="10.67" height="20" fill="#EF4135" />
    </g>
  </svg>
);

export function Header({ locales, currentLang }: Props) {
  const [isLangOpen, setIsLangOpen] = useState(false);
  const langRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleClickOutside = (e: MouseEvent) => {
      if (langRef.current && !langRef.current.contains(e.target as Node)) {
        setIsLangOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const [isScrolled, setIsScrolled] = useState(false);

  useEffect(() => {
    const handleScroll = () => {
      setIsScrolled(window.scrollY > 10);
    };

    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  return (
    <header
      className={`w-full fixed top-0 left-0 right-0 z-50 p-8 transition-all duration-300 ${
        isScrolled
          ? "bg-[#f7f7f9]/90 backdrop-blur-lg border-b border-[#f0eadf]"
          : "bg-transparent"
      }`}
    >
      <div className="max-w-[1440px] mx-auto px-6 md:px-10 xl:px-20 py-4 flex items-center justify-between">
        {/* LOGO */}
        <PrismicNextLink href="/" className="flex items-center">
          <svg
            width="154"
            height="34"
            viewBox="0 0 154 34"
            fill="none"
            data-astro-cid-pwmmw5ba="true"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M5.84929 25.83C4.89325 26.7961 3.32791 26.7961 2.37134 25.83C1.41424 24.8639 0.631836 24.0738 0.631836 24.0738L17.154 7.38721L20.6319 10.9003L20.6248 10.9074L33.7188 24.1317L31.9799 25.888C31.0228 26.8541 29.4579 26.8541 28.5014 25.888L26.7624 24.1317L17.1466 14.4203L7.58827 24.0738L5.84929 25.83Z"
              fill="#212121"
            ></path>
            <path
              d="M44.8311 10.232L49.0608 10.232L51.7896 15.9081L51.8988 15.9081L54.6276 10.232L58.8574 10.232L53.7271 19.8103L53.7271 24.2038L49.9613 24.2038L49.9613 19.8103L44.8311 10.232Z"
              fill="#212121"
            ></path>
            <path
              d="M66.8019 24.3948C65.6649 24.3948 64.6916 24.1697 63.8821 23.7194C63.0725 23.2646 62.4517 22.6324 62.0196 21.8228C61.5876 21.0087 61.3715 20.065 61.3715 18.9917C61.3715 17.9183 61.5876 16.9769 62.0196 16.1673C62.4517 15.3532 63.0725 14.721 63.8821 14.2707C64.6916 13.8159 65.6649 13.5885 66.8019 13.5885C67.939 13.5885 68.9123 13.8159 69.7218 14.2707C70.5314 14.721 71.1522 15.3532 71.5843 16.1673C72.0163 16.9769 72.2324 17.9183 72.2324 18.9917C72.2324 20.065 72.0163 21.0087 71.5843 21.8228C71.1522 22.6324 70.5314 23.2646 69.7218 23.7194C68.9123 24.1697 67.939 24.3948 66.8019 24.3948ZM66.8292 21.6114C67.1476 21.6114 67.4228 21.5045 67.6547 21.2907C67.8867 21.077 68.0663 20.7722 68.1937 20.3766C68.321 19.9809 68.3847 19.5101 68.3847 18.9644C68.3847 18.4141 68.321 17.9433 68.1937 17.5522C68.0663 17.1565 67.8867 16.8518 67.6547 16.638C67.4228 16.4243 67.1476 16.3174 66.8292 16.3174C66.4927 16.3174 66.2039 16.4243 65.9628 16.638C65.7218 16.8518 65.5376 17.1565 65.4102 17.5522C65.2829 17.9433 65.2192 18.4141 65.2192 18.9644C65.2192 19.5101 65.2829 19.9809 65.4102 20.3766C65.5376 20.7722 65.7218 21.077 65.9628 21.2907C66.2039 21.5045 66.4927 21.6114 66.8292 21.6114Z"
              fill="#212121"
            ></path>
            <path
              d="M83.078 28.3516C82.0274 28.3516 81.1269 28.2015 80.3765 27.9014C79.6306 27.6057 79.0507 27.1964 78.6368 26.6734C78.2275 26.1549 77.9978 25.5591 77.9478 24.886L81.5772 24.886C81.6136 25.1088 81.7045 25.2885 81.8501 25.4249C81.9956 25.5614 82.1821 25.6592 82.4095 25.7183C82.6414 25.782 82.9007 25.8138 83.1872 25.8138C83.6738 25.8138 84.0763 25.6955 84.3947 25.459C84.7176 25.2225 84.8791 24.795 84.8791 24.1765L84.8791 22.4027L84.7699 22.4027C84.6335 22.7575 84.4243 23.0599 84.1423 23.3101C83.8603 23.5557 83.5215 23.7444 83.1258 23.8763C82.7301 24.0037 82.2958 24.0673 81.8228 24.0673C81.0769 24.0673 80.3901 23.8945 79.7625 23.5489C79.1394 23.2032 78.6391 22.6552 78.2616 21.9047C77.8887 21.1543 77.7022 20.1742 77.7022 18.9644C77.7022 17.7 77.8978 16.6721 78.2889 15.8808C78.6846 15.0894 79.194 14.5095 79.8171 14.1411C80.4447 13.7727 81.1042 13.5885 81.7955 13.5885C82.314 13.5885 82.7688 13.6795 83.1599 13.8614C83.551 14.0388 83.8785 14.2776 84.1423 14.5777C84.4061 14.8734 84.6062 15.1986 84.7426 15.5533L84.8245 15.5533L84.8245 13.725L88.5903 13.725L88.5903 24.1765C88.5903 25.0634 88.3606 25.8161 87.9013 26.4346C87.4465 27.0577 86.8052 27.533 85.9775 27.8604C85.1497 28.1879 84.1832 28.3516 83.078 28.3516ZM83.2145 21.3931C83.5601 21.3931 83.8558 21.2975 84.1014 21.1065C84.3515 20.911 84.5425 20.6335 84.6744 20.2742C84.8109 19.9104 84.8791 19.4738 84.8791 18.9644C84.8791 18.4459 84.8109 18.0025 84.6744 17.6341C84.5425 17.2611 84.3515 16.9769 84.1014 16.7813C83.8558 16.5812 83.5601 16.4811 83.2145 16.4811C82.8688 16.4811 82.5732 16.5812 82.3276 16.7813C82.0866 16.9769 81.9001 17.2611 81.7682 17.6341C81.6408 18.0025 81.5772 18.4459 81.5772 18.9644C81.5772 19.4829 81.6408 19.924 81.7682 20.2879C81.9001 20.6472 82.0866 20.9223 82.3276 21.1133C82.5732 21.2998 82.8688 21.3931 83.2145 21.3931Z"
              fill="#212121"
            ></path>
            <path
              d="M97.6947 24.3675C97.0261 24.3675 96.4348 24.2584 95.9209 24.04C95.4115 23.8172 95.0113 23.4806 94.7202 23.0304C94.4291 22.5801 94.2836 22.007 94.2836 21.3112C94.2836 20.7381 94.3814 20.2492 94.5769 19.8444C94.7725 19.4351 95.0454 19.1008 95.3956 18.8416C95.7458 18.5823 96.1529 18.3845 96.6168 18.248C97.0852 18.1116 97.5901 18.0229 98.1313 17.982C98.718 17.9365 99.1887 17.8819 99.5435 17.8183C99.9028 17.75 100.162 17.6568 100.321 17.5385C100.48 17.4157 100.56 17.2543 100.56 17.0542L100.56 17.0269C100.56 16.754 100.455 16.5448 100.246 16.3992C100.037 16.2537 99.7686 16.1809 99.4411 16.1809C99.0818 16.1809 98.7885 16.2605 98.5611 16.4197C98.3382 16.5744 98.204 16.8131 98.1586 17.136L94.6929 17.136C94.7384 16.4993 94.9408 15.9126 95.3001 15.3759C95.6639 14.8347 96.1938 14.4026 96.8896 14.0797C97.5855 13.7523 98.4542 13.5885 99.4957 13.5885C100.246 13.5885 100.919 13.6772 101.515 13.8546C102.111 14.0274 102.618 14.2707 103.036 14.5846C103.455 14.8938 103.773 15.2577 103.991 15.6761C104.214 16.09 104.326 16.5402 104.326 17.0269L104.326 24.2038L100.806 24.2038L100.806 22.7302L100.724 22.7302C100.514 23.1213 100.26 23.4374 99.9596 23.6785C99.664 23.9195 99.3252 24.0946 98.9431 24.2038C98.5656 24.3129 98.1495 24.3675 97.6947 24.3675ZM98.9226 21.9934C99.2092 21.9934 99.4775 21.9343 99.7277 21.816C99.9823 21.6978 100.189 21.5272 100.348 21.3044C100.508 21.0815 100.587 20.8109 100.587 20.4925L100.587 19.6193C100.487 19.6602 100.38 19.6989 100.267 19.7353C100.157 19.7717 100.039 19.8058 99.9119 19.8376C99.7891 19.8694 99.6572 19.899 99.5162 19.9263C99.3797 19.9536 99.2365 19.9786 99.0864 20.0013C98.7953 20.0468 98.5565 20.1219 98.37 20.2265C98.1881 20.3265 98.0517 20.4516 97.9607 20.6017C97.8743 20.7472 97.8311 20.911 97.8311 21.0929C97.8311 21.384 97.9334 21.6068 98.1381 21.7615C98.3428 21.9161 98.6043 21.9934 98.9226 21.9934Z"
              fill="#212121"
            ></path>
            <path
              d="M117.271 17.2179L117.271 20.0559L110.722 20.0559L110.722 17.2179L117.271 17.2179Z"
              fill="#212121"
            ></path>
            <path
              d="M132.8 14.8438C132.741 14.6028 132.648 14.3913 132.52 14.2093C132.393 14.0229 132.234 13.866 132.043 13.7386C131.856 13.6067 131.638 13.5089 131.388 13.4453C131.142 13.377 130.872 13.3429 130.576 13.3429C129.939 13.3429 129.396 13.4953 128.946 13.8C128.5 14.1047 128.159 14.5436 127.922 15.1167C127.69 15.6897 127.574 16.3811 127.574 17.1906C127.574 18.0093 127.686 18.7097 127.909 19.2918C128.131 19.874 128.463 20.3197 128.905 20.629C129.346 20.9382 129.894 21.0929 130.549 21.0929C131.126 21.0929 131.606 21.0087 131.988 20.8405C132.375 20.6722 132.664 20.4334 132.855 20.1241C133.046 19.8149 133.141 19.451 133.141 19.0326L133.796 19.1008L130.603 19.1008L130.603 16.3992L136.798 16.3992L136.798 18.3367C136.798 19.6102 136.527 20.6995 135.986 21.6045C135.449 22.5051 134.708 23.1964 133.762 23.6785C132.821 24.156 131.74 24.3948 130.521 24.3948C129.162 24.3948 127.968 24.106 126.94 23.5284C125.912 22.9508 125.109 22.1276 124.532 21.0588C123.959 19.99 123.672 18.7188 123.672 17.2452C123.672 16.09 123.847 15.0667 124.197 14.1752C124.552 13.2838 125.043 12.5311 125.671 11.9171C126.299 11.2986 127.024 10.8324 127.847 10.5186C128.67 10.2002 129.553 10.041 130.494 10.041C131.322 10.041 132.091 10.1593 132.8 10.3958C133.514 10.6277 134.144 10.9597 134.69 11.3918C135.24 11.8193 135.684 12.3264 136.02 12.9131C136.357 13.4998 136.561 14.1434 136.634 14.8438L132.8 14.8438Z"
              fill="#212121"
            ></path>
            <path
              d="M147.939 24.3948C146.802 24.3948 145.828 24.1697 145.019 23.7194C144.209 23.2646 143.588 22.6324 143.156 21.8228C142.724 21.0087 142.508 20.065 142.508 18.9917C142.508 17.9183 142.724 16.9769 143.156 16.1673C143.588 15.3532 144.209 14.721 145.019 14.2707C145.828 13.8159 146.802 13.5885 147.939 13.5885C149.076 13.5885 150.049 13.8159 150.858 14.2707C151.668 14.721 152.289 15.3532 152.721 16.1673C153.153 16.9769 153.369 17.9183 153.369 18.9917C153.369 20.065 153.153 21.0087 152.721 21.8228C152.289 22.6324 151.668 23.2646 150.858 23.7194C150.049 24.1697 149.076 24.3948 147.939 24.3948ZM147.966 21.6114C148.284 21.6114 148.559 21.5045 148.791 21.2907C149.023 21.077 149.203 20.7722 149.33 20.3766C149.458 19.9809 149.521 19.5101 149.521 18.9644C149.521 18.4141 149.458 17.9433 149.33 17.5522C149.203 17.1565 149.023 16.8518 148.791 16.638C148.559 16.4243 148.284 16.3174 147.966 16.3174C147.629 16.3174 147.34 16.4243 147.099 16.638C146.858 16.8518 146.674 17.1565 146.547 17.5522C146.42 17.9433 146.356 18.4141 146.356 18.9644C146.356 19.5101 146.42 19.9809 146.547 20.3766C146.674 20.7722 146.858 21.077 147.099 21.2907C147.34 21.5045 147.629 21.6114 147.966 21.6114Z"
              fill="#212121"
            ></path>
          </svg>{" "}
        </PrismicNextLink>

        {/* NAV LINKS */}
        <nav className="hidden lg:flex gap-6 text-base text-gray-900">
          <a
            href="#"
            className="hover:text-primary hover:bg-[#e4e4e7] px-4 py-2 rounded-xl tracking-wider transition uppercase"
          >
            Product Tour
          </a>
          <div className="relative group">
            <button className="flex items-center tracking-wider gap-3 hover:text-primary transition uppercase hover:text-primary hover:bg-[#e4e4e7] px-4 py-2 rounded-xl tracking-wider transition uppercase">
              Features
              <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                <path
                  d="M10.9375 1.5L5.9375 6.5L0.9375 1.5"
                  stroke="#212121"
                  strokeWidth="1.5"
                  strokeLinecap="round"
                />
              </svg>
            </button>
            {/* Dropdown placeholder */}
          </div>
          <a
            href="#"
            className="hover:text-primary hover:bg-[#e4e4e7] px-4 py-2 rounded-xl tracking-wider transition uppercase"
          >
            Help Center
          </a>
          <a
            href="#"
            className="hover:text-primary hover:bg-[#e4e4e7] px-4 py-2 rounded-xl tracking-wider transition uppercase"
          >
            Wellness Hub
          </a>
        </nav>

        {/* CTA + LANGUAGE */}
        <div className="hidden lg:flex items-center gap-6">
          <a
            href="#"
            className="bg-[#FFD500] hover:bg-[#E7B211] text-black text-sm font-bold uppercase px-6 py-2 rounded-xl transition shadow-md"
          >
            Join Us
          </a>

          {/* Language Switcher */}
          <div className="relative" ref={langRef}>
            <button
              onClick={() => setIsLangOpen(!isLangOpen)}
              className="flex items-center gap-2 text-sm font-medium text-black rounded-xl px-3 py-1 "
            >
              <span className="text-xl">
                {currentLang === "fr-fr" ? FRFlag : UKFlag}
              </span>
              <svg
                className={`transition-transform ${isLangOpen ? "rotate-180" : ""}`}
                width="12"
                height="8"
                viewBox="0 0 12 8"
                fill="none"
              >
                <path
                  d="M10.9375 1.5L5.9375 6.5L0.9375 1.5"
                  stroke="#212121"
                  strokeWidth="1.5"
                  strokeLinecap="round"
                />
              </svg>
            </button>

            {isLangOpen && (
              <ul className="absolute right-0 mt-2 w-52 bg-[#f0e7c9] z-50 shadow-lg rounded-xl border border-[#e3d6b6]">
                {locales.map((locale) => (
                  <li key={locale.lang}>
                    <button
                      onClick={() => {
                        window.location.href = locale.url ?? "/en-us";
                      }}
                      className={`w-full text-left px-4 py-2 text-sm flex items-center gap-2 bg-[#e3d6b6] hover:bg-[#f7f1db] transition ${
                        currentLang === locale.lang ? "font-semibold" : ""
                      }`}
                    >
                      {locale.lang === "en-us" ? (
                        <>{UKFlag} ENGLISH</>
                      ) : locale.lang === "fr-fr" ? (
                        <>{FRFlag} FRENCH</>
                      ) : (
                        locale.lang
                      )}
                    </button>
                  </li>
                ))}
              </ul>
            )}
          </div>
        </div>

        {/* MOBILE MENU */}
        <button className="lg:hidden flex flex-col gap-[5px]" aria-label="Menu">
          <span className="block w-6 h-[2px] bg-gray-900" />
          <span className="block w-6 h-[2px] bg-gray-900" />
          <span className="block w-6 h-[2px] bg-gray-900" />
        </button>
      </div>
    </header>
  );
}
